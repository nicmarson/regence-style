jQuery.webshims.register("track-ui",function(e,t,n,r,i){"use strict";function h(e,t){var n=!0,r=0,i=e.length;if(i!=t.length)n=!1;else for(;r<i;r++)if(e[r]!=t[r]){n=!1;break}return n}var s=t.cfg.track,o={type:"enter"},u={type:"exit"},a={subtitles:1,captions:1,descriptions:1},f=t.mediaelement,l=function(){return!s.override&&Modernizr.track},c={update:function(n,r){if(!n.activeCues.length)this.hide(n);else if(!h(n.displayedActiveCues,n.activeCues)){n.displayedActiveCues=n.activeCues;if(!n.trackDisplay){n.trackDisplay=e('<div class="cue-display"><span class="description-cues" aria-live="assertive" /></div>').insertAfter(r);this.addEvents(n,r);t.docObserve()}n.hasDirtyTrackDisplay&&r.triggerHandler("forceupdatetrackdisplay");this.showCues(n)}},showCues:function(t){var n=e('<span class="cue-wrapper" />');e.each(t.displayedActiveCues,function(r,i){var s=i.id?'id="cue-id-'+i.id+'"':"",o=e('<span class="cue-line"><span '+s+' class="cue" /></span>').find("span").html(i.getCueAsHTML()).end();i.track.kind=="descriptions"?setTimeout(function(){e("span.description-cues",t.trackDisplay).html(o)},0):n.prepend(o)});e("span.cue-wrapper",t.trackDisplay).remove();t.trackDisplay.append(n)},addEvents:function(e,t){if(s.positionDisplay){var n,r=function(n){if(e.displayedActiveCues.length||n===!0){e.trackDisplay.css({display:"none"});var r=t.getShadowElement(),i=r.offsetParent(),s=r.innerHeight(),o=r.innerWidth(),u=r.position(),a=s*o;e.trackDisplay.css({left:u.left,width:o,height:s-45,top:u.top,display:"block"});e.trackDisplay.css("fontSize",Math.max(Math.round(s/30),7));e.hasDirtyTrackDisplay=!1}else e.hasDirtyTrackDisplay=!0},i=function(e){clearTimeout(n);n=setTimeout(r,0)},o=function(){r(!0)};t.on("updateshadowdom playerdimensionchange mediaelementapichange updatetrackdisplay updatemediaelementdimensions swfstageresize",i);t.on("forceupdatetrackdisplay",o);o()}},hide:function(t){if(t.trackDisplay&&t.displayedActiveCues.length){t.displayedActiveCues=[];e("span.cue-wrapper",t.trackDisplay).remove();e("span.description-cues",t.trackDisplay).empty()}}};e.extend(e.event.customEvent,{updatetrackdisplay:!0,forceupdatetrackdisplay:!0});f.trackDisplay=c;if(!f.createCueList){var p={getCueById:function(e){var t=null;for(var n=0,r=this.length;n<r;n++)if(this[n].id===e){t=this[n];break}return t}};f.createCueList=function(){return e.extend([],p)}}f.getActiveCue=function(t,n,r,i){t._lastFoundCue||(t._lastFoundCue={index:0,time:0});Modernizr.track&&!s.override&&!t._shimActiveCues&&(t._shimActiveCues=f.createCueList());var o=0,u,l;for(;o<t.shimActiveCues.length;o++){l=t.shimActiveCues[o];if(l.startTime>r||l.endTime<r){t.shimActiveCues.splice(o,1);o--;l.pauseOnExit&&e(n).pause();e(t).triggerHandler("cuechange");e(l).triggerHandler("exit")}else t.mode=="showing"&&a[t.kind]&&e.inArray(l,i.activeCues)==-1&&i.activeCues.push(l)}u=t.cues.length;o=t._lastFoundCue.time<r?t._lastFoundCue.index:0;for(;o<u;o++){l=t.cues[o];if(l.startTime<=r&&l.endTime>=r&&e.inArray(l,t.shimActiveCues)==-1){t.shimActiveCues.push(l);t.mode=="showing"&&a[t.kind]&&i.activeCues.push(l);e(t).triggerHandler("cuechange");e(l).triggerHandler("enter");t._lastFoundCue.time=r;t._lastFoundCue.index=o}if(l.startTime>r)break}};l()&&function(){var n,r=function(t){setTimeout(function(){n=!0;e(t).triggerHandler("updatetrackdisplay");n=!1},9)},i=function(i,s,o){var u="_sup"+o,a={prop:{}},f;a.prop[o]=function(){!n&&l()&&r(e(this).closest("audio, video"));return f.prop[u].apply(this,arguments)};f=t.defineNodeNameProperty(i,s,a)};i("track","track","get");["audio","video"].forEach(function(e){i(e,"textTracks","get");i("nodeName","addTextTrack","value")})}();t.addReady(function(n,r){e("video, audio",n).add(r.filter("video, audio")).each(function(){var n=e(this),r=function(e){var r,i;if(!u||!o){u=n.prop("textTracks");o=t.data(n[0],"mediaelementBase")||t.data(n[0],"mediaelementBase",{});o.displayedActiveCues||(o.displayedActiveCues=[])}if(!u)return;i=n.prop("currentTime");if(!i&&i!==0)return;o.activeCues=[];for(var s=0,a=u.length;s<a;s++){r=u[s];r.mode!="disabled"&&r.cues&&r.cues.length&&f.getActiveCue(r,n,i,o)}c.update(o,n)},i=function(e){clearTimeout(a);if(e&&e.type=="timeupdate"){r();setTimeout(i,90)}else a=setTimeout(r,9)},s=function(){n.off(".trackview").on("play.trackview timeupdate.trackview updatetrackdisplay.trackview",i)},o,u,a;l()?n.on("mediaelementapichange trackapichange",function(){if(!l()||n.is(".nonnative-api-active"))s();else{u=n.prop("textTracks");o=t.data(n[0],"mediaelementBase")||t.data(n[0],"mediaelementBase",{});e.each(u,function(e,t){t._shimActiveCues&&delete t._shimActiveCues});c.hide(o);n.unbind(".trackview")}}):s()})})});